language: python
python:
  - "3.6"
notifications:
  email: false

cache:
  directories:
   - $HOME/.cache/pip

env:
  global:
    - MINICONDA_DIST=Miniconda3-4.5.4-Linux-x86_64.sh
    - MINICONDA_SOURCE=https://repo.continuum.io/miniconda
    - CONDA_DIR=$HOME/miniconda3
    - PATH=$CONDA_DIR/bin:$PATH

  matrix:
    - TO_TEST=CODE
    - TO_TEST=NOTEBOOKS
    - TO_TEST=STYLE
    - TO_TEST=BROWSER

before_install: 
  - if [ "$TO_TEST" = "BROWSER" ]; then source build_tools/before_install.sh; fi
  
install:
  - if [ "$TO_TEST" = "BROWSER" ]; then conda env update -n robot --file ${TRAVIS_BUILD_DIR}/build_tools/robot_tests.yml; fi
  - if [ "$TO_TEST" = "BROWSER" ]; then source activate robot; fi
  - pip install -e .
  - pip install pytest-cov codecov mypy flake8 nose
  - if [ "$TO_TEST" = "NOTEBOOKS" ]; then pip install notebook nbconvert; fi

script:
  - if [ "$TO_TEST" = "CODE" ]; then mypy -p cornerstone_widget --ignore-missing-imports; fi
  - if [ "$TO_TEST" = "CODE" ]; then pytest --cov=cornerstone_widget; fi
  - if [ "$TO_TEST" = "CODE" ]; then codecov; fi
  - if [ "$TO_TEST" = "STYLE" ]; then flake8 --ignore E501,F401; fi
  - if [ "$TO_TEST" = "NOTEBOOKS" ]; then source build_tools/travis_notebooks.sh; fi
